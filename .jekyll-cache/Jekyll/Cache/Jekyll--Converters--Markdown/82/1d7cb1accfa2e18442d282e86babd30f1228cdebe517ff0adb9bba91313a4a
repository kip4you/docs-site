I"µ&<h1 id="anonymous-task">Anonymous Task</h1>

<h2 id="what-is-an-anonymous-task">What is an Anonymous Task?</h2>

<p>Anonymous Task is an activity where we can access a task anonymously, in other words, it will have an email that contains a link to lead you to the task no need to have an account in the website, accessing as if a guest.</p>

<h2 id="1-camunda">1. Camunda</h2>

<p>Initially we need to create a Camunda BPMN to organize our process flow, to this in this tutorial we‚Äôll use the Quote Item example.</p>

<p><img src="assets/images/anonymous-task/TaskQuoteItem.png" alt="Task Quote Item in Camunda BPMN" /></p>

<p>The Quote Item, will be our anonymous task, but to turn this activity into an anonymous one we‚Äôll need to include other two tasks before the User Task, being these the Service Task (Akip Configure Anonymous Task) and a Send Task (Email to Provider) that we‚Äôll send a link with a token to access the activity anonymously.
This way:</p>

<p><img src="assets/images/anonymous-task/QuoteItemAnonimo.png" alt="Service Task, Send Task and then the Quote Item task" /></p>

<p>Clicking in the Service Task (Akip Configure Anonymous Task) we must indicate in the delegate section ${akipConfigureAnonymousTaskDelegate} that refers to an existing compiled class in the architecture of reference.</p>

<p><img src="assets/images/anonymous-task/BPMNconfig.png" alt="Service Task delegate configuration" style="display:block; margin-left:auto; margin-right:auto" /></p>

<h2 id="2-project-generation">2. Project Generation</h2>

<p>Before we pass to the coding the anonymous task, we need first to install the AgileKIP Generator to execute the project using the jhipster bluepirnt, after this we need to create the metadata of the domain, entities and their relations. To create the project step by step it‚Äôs recommended to read the tutorial <a href="https://agilekip.github.io/pap-documentation/tutorials/generating-an-app" style="color: blue">here</a></p>

<h2 id="3-into-the-code">3. Into the code</h2>

<p>In the code of the generated code initially, we need to find in out project the file Controller related to the task, in our example is TaskQuoteItemController.</p>

<p><img src="assets/images/anonymous-task/PathController.png" alt="Path to controller" style="display:block; margin-left:auto; margin-right:auto" /></p>

<p>It‚Äôs indicated that in the Controller, we change the <strong>@RequestMapping(‚Äú/api/‚Ä¶‚Äù)</strong> to <strong>@RequestMapping(‚Äú/api‚Äù)</strong>, and then in the <strong>@GettingMapping</strong> and <strong>PostMapping</strong> use the part that was removed in the @RequestMapping, like this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/api"</span><span class="o">)</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/quotation-process/task-quote-item/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">TaskQuoteItemContextDTO</span><span class="o">&gt;</span> <span class="nf">loadContext</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"REST request to load the context of task hotel {}"</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
        <span class="nc">TaskQuoteItemContextDTO</span> <span class="n">taskQuoteItemContext</span> <span class="o">=</span> <span class="n">taskQuoteItemService</span><span class="o">.</span><span class="na">loadContext</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">taskQuoteItemContext</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>After this, for each one of the <strong>@GetMapping</strong> and <strong>@PostMapping</strong> we must do copies with some changes, informing the paths that will be public utilized for the Anonymous Task.</p>

<p>In the image below, when we create the copy for each one, we must pass in the start of the URL the <strong>‚Äú/public‚Äù</strong> to indicate that this will be a public URL, moreover in the final os the URL we need to write the id of the process instance (<strong>processInstanceId</strong>) informing the instance of the process, as well as the Token (<strong>accessTokenNumber</strong>) that will be generated unique for each provider that need to quote items in our case.</p>

<p><img src="assets/images/anonymous-task/PublicGetMappingExemplo.png" alt="GetMapping for public" /></p>

<p>In addition, we must replace the method <strong>loadContext</strong> to <strong>loadContextPublic</strong> and pass the two variables of the URL, <strong>processInstanceId</strong> and <strong>accessTokenNumber</strong> as parameters. The creation of this method will be done in a step further.</p>

<p>Following the red marks in the image, we must change the <strong>log.debug</strong>, passing again the respective variables, <strong>processInstanceId</strong> and <strong>accessTokenNumber</strong>.</p>

<p>Lastly, we use the instance of the service in our task, passing now <strong>loadContextPublic</strong> and the two parameters, <strong>processInstanceId</strong> and <strong>accessTokenNumber</strong>. Following this same logic we gonna create a copy of <strong>claim</strong>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/public/quotation-process/task-quote-item/{processInstanceId}/{accessTokenNumber}/claim"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">TaskQuoteItemContextDTO</span><span class="o">&gt;</span> <span class="nf">claimPublic</span><span class="o">(</span>
    <span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">processInstanceId</span><span class="o">,</span>
    <span class="nd">@PathVariable</span> <span class="nc">String</span> <span class="n">accessTokenNumber</span>
        <span class="o">)</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"REST request to load the context of task hotel {}"</span><span class="o">,</span> <span class="n">processInstanceId</span><span class="o">,</span> <span class="n">accessTokenNumber</span><span class="o">);</span>
        <span class="nc">TaskQuoteItemContextDTO</span> <span class="n">taskQuoteItemContext</span> <span class="o">=</span> <span class="n">taskQuoteItemService</span><span class="o">.</span><span class="na">claimPublic</span><span class="o">(</span><span class="n">processInstanceId</span><span class="o">,</span> <span class="n">accessTokenNumber</span><span class="o">);</span>
        <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">taskQuoteItemContext</span><span class="o">);</span>
        <span class="o">}</span>
</code></pre></div></div>

<p>When we create the copy of the complete, we only need to change the URL adding the <strong>‚Äú/public/‚Äù</strong> in the start, and the name of the method complete to <strong>completePublic</strong>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"public/quotation-process/task-quote-item/complete"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="nf">completePublic</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="nc">TaskQuoteItemContextDTO</span> <span class="n">taskQuoteItemContext</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"REST request to complete QuotationProcess.TaskQuoteItem {}"</span><span class="o">,</span> <span class="n">taskQuoteItemContext</span><span class="o">.</span><span class="na">getTaskInstance</span><span class="o">().</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">taskQuoteItemService</span><span class="o">.</span><span class="na">complete</span><span class="o">(</span><span class="n">taskQuoteItemContext</span><span class="o">);</span>
        <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">noContent</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>With this we finished the necessary changes for te Controller in the Anonymous Task. The next step is to implement te public methods that we create (loadContextPublic, claimPublic and completePublic). To do this we‚Äôll go to the Service located in:</p>

<p><img src="./assets/images/anonymous-task/ServiceMarcado.png" alt="Location of the Service in the backend" /></p>

:ET