<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.17.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Kip4You</title>
<meta name="description" content="A passionate team to investigate  aspects related to Agile and Knowledge Intensive Processes.">


  <meta name="author" content="Kip4You Team">


<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Kip4You">
<meta property="og:title" content="Kip4You">
<meta property="og:url" content="http://0.0.0.0:4000/connector-email">


  <meta property="og:description" content="A passionate team to investigate  aspects related to Agile and Knowledge Intensive Processes.">











  

  


<link rel="canonical" href="http://0.0.0.0:4000/connector-email">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Kip4You Team",
      "url": "http://0.0.0.0:4000/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Kip4You Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/kip4you-docs-logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          Kip4You
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about" >About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          
          

          <a href="/about-kip4you-pap"><span class="nav__sub-title">About</span></a>
        

        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Fundamentals</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/native-features" class="">Native Features</a></li>
          
            
            

            
            

            <li><a href="/agility" class="">Agility</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Developers</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/tenants" class="">Tenants</a></li>
          
            
            

            
            

            <li><a href="/deployment-properties" class="">Deployment Properties</a></li>
          
            
            

            
            

            <li><a href="/guest-users" class="">Guest Users</a></li>
          
            
            

            
            

            <li><a href="/attachments" class="">Attachments</a></li>
          
            
            

            
            

            <li><a href="/notes" class="">Notes</a></li>
          
            
            

            
            

            <li><a href="/search-framework" class="">Search Framework</a></li>
          
            
            

            
            

            <li><a href="/dashboards-basic" class="">Basic Dashboards</a></li>
          
            
            

            
            

            <li><a href="/dashboards-advanced" class="">Advanced Dashboards</a></li>
          
            
            

            
            

            <li><a href="/dashboards-on-the-fly" class="">On-the-fly Dashboards</a></li>
          
            
            

            
            

            <li><a href="/connector-email" class="active">Email Connector</a></li>
          
            
            

            
            

            <li><a href="/connector-rest-api" class="">Rest API Connector</a></li>
          
            
            

            
            

            <li><a href="/connector-activemq" class="">ActiveMQ Connector</a></li>
          
            
            

            
            

            <li><a href="/dynamic-forms" class="">Dynamic Forms</a></li>
          
            
            

            
            

            <li><a href="/subprocess" class="">Subprocess</a></li>
          
            
            

            
            

            <li><a href="/anonymous-task" class="">Anonymous Task</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    
    
    
    <meta itemprop="dateModified" content="August 07, 2022">

    <div class="page__inner-wrap">
      
        <header>
          
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#email-connector">Email Connector</a>
    <ul>
      <li><a href="#1-camunda">1. Camunda</a></li>
      <li><a href="#2-project-generation">2. Project Generation</a></li>
      <li><a href="#3-into-the-code">3. Into the code</a></li>
    </ul>
  </li>
</ul>
            </nav>
          </aside>
        
        <h1 id="email-connector">Email Connector</h1>

<h2 id="1-camunda">1. Camunda</h2>

<p>Initially to create an Email, we need to configure our Camunda BPMN.</p>

<p><img src="./assets/images/email-connector/BPMNEmail.png" alt="Simple example of BPMN" /></p>

<p>In this case it is common to have a task before send the Email in our case we have the <strong>Assess Quotation</strong> task a User Task, that simply approve or disapprove a quotation. If the quotation is approved than it send the <strong>Email Approval Quotation</strong> and if it is not approved it send <strong>Email Disapproval Quotation</strong>.</p>

<p>To simplify this tutorial we’ll only do the Email Approval Quotation. CLicking in the send task we open a tab to configure, first we click in <strong>Implementation</strong> and set te Type to <strong>Delegate Expression</strong> and put in Delegate expression <strong>${akipEmailConnectorDelegate}</strong>, this delegate already exists as a compiled class when we generate the base project.</p>

<p><img src="./assets/images/email-connector/SendTaskImplemantation.png" alt="Email Implementation Configuration" style="display:block; margin-left:auto; margin-right:auto" /></p>

<p>Still in the configuration of Email Approval Quotation we click in <strong>Field injections</strong> and click in <strong>Create a new list item</strong> (plus icon), we’ll add the Name <strong>akipEmailConnectorConfigName</strong>, Type <strong>String</strong> and then the Value that we put the name of the process dot the name of our task using <strong>CamelCase</strong>, in our case it will be <strong>QuotationProcess.EmailApprovalQuotation</strong>.</p>

<p><img src="./assets/images/email-connector/SendTaskInjection.png" alt="Email Field Injection Configuration" style="display:block; margin-left:auto; margin-right:auto" /></p>

<h2 id="2-project-generation">2. Project Generation</h2>

<p>Before we pass to the coding the Email task, we need first to install the AgileKIP Generator to execute the project using the jhipster blueprint, after this we need to create the metadata of the domain, entities and their relations. To create the project step by step it’s recommended to read the tutorial <a href="https://agilekip.github.io/pap-documentation/tutorials/generating-an-app" style="color: blue">here</a></p>

<h2 id="3-into-the-code">3. Into the code</h2>

<p>After we config the Email task in Camunda, just need to construct the body of the email. For that we’ll start by entering the folder with the name of the process through this path: <strong>src &gt; main &gt; resources &gt; config &gt; liquibase &gt; data &gt; quotationProcess</strong> (in our case). Inside this folder we create three types of file to construct the email: the <strong>content.txt</strong>, <strong>mailbox.txt</strong> and the <strong>subject.txt</strong> all with the name of the process dot the name of the task (example: QuotationProcess.EmailApprovalQuotation.content.txt).</p>

<p><img src="./assets/images/email-connector/pathEmail.png" alt="Path to body of the email" /></p>

<p>First in the subject.txt we’ll fill this file with the title of the Email. Notice that inside this txt we can bring the value of some attribute using the <strong>${}</strong>.</p>

<p><img src="./assets/images/email-connector/subject.png" alt="Email subject" /></p>

<p>Now inside the mailbox.txt we define the emails address that this emails will be sent.</p>

<p><img src="./assets/images/email-connector/mailbox.png" alt="Email content" /></p>

<p>The last step to construct the body of the email is the content, inside the content.txt we write what we want to present for the user using &lt;p&gt;&lt;/p&gt; tags.</p>

<p><img src="./assets/images/email-connector/content.png" alt="Email content" /></p>

<p>We can manipulate data in this file using SQL, doing for loops, whiles and other stuff, here is another example of a content.txt for an email (Email RFQ Summary) of a summary of items that have been quoted.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>String requisicaoHql = """ SELECT q FROM Quotation q WHERE q.requestForQuotation.id = ${processEntity.requestForQuotation.id} """
def listQuotations = hqlApi.findList(requisicaoHql)
 def tableQuotations =   """
    <span class="nt">&lt;p&gt;</span>Dear ${processEntity.requestForQuotation.user.login}<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>Below is the summary containing all quotations for the item ${processEntity.requestForQuotation.item.name}<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/br&gt;</span>
"""
 tableQuotations += """<span class="nt">&lt;table</span> <span class="na">border=</span><span class="s">"1"</span> <span class="na">style=</span><span class="s">"width: 100%"</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;tr&gt;</span>
                                   <span class="nt">&lt;td&gt;</span>Name<span class="nt">&lt;/td&gt;</span>
                                   <span class="nt">&lt;td&gt;</span>Description<span class="nt">&lt;/td&gt;</span>
                                   <span class="nt">&lt;td&gt;</span>Price<span class="nt">&lt;/td&gt;</span>
                          <span class="nt">&lt;/tr&gt;</span>
                          """
    listQuotations.findAll{ quotation -&gt; quotation.statusQuotation.toString() != 'DISAPPROVED' }.each{ quotation -&gt;
      tableQuotations += """
         <span class="nt">&lt;tr&gt;</span>
         <span class="nt">&lt;td&gt;</span>
           <span class="nt">&lt;p&gt;</span>${quotation.provider.name}<span class="nt">&lt;/p&gt;</span>
         <span class="nt">&lt;/td&gt;</span>
          <span class="nt">&lt;td&gt;</span>
           <span class="nt">&lt;p&gt;</span>${quotation.requestForQuotation.item.description}<span class="nt">&lt;/p&gt;</span>
          <span class="nt">&lt;/td&gt;</span>
          <span class="nt">&lt;td&gt;</span>
           <span class="nt">&lt;p&gt;</span>US\$ ${quotation.price}<span class="nt">&lt;/p&gt;</span>
          <span class="nt">&lt;/td&gt;</span>
     <span class="nt">&lt;/tr&gt;</span>
     """
     }
tableQuotations +="<span class="nt">&lt;/table&gt;</span>"
"""
${tableQuotations}
<span class="nt">&lt;p&gt;</span>Regards, AgileKip Team<span class="nt">&lt;/p&gt;</span>
"""
</code></pre></div></div>

<p>Finishing the body of the email, we must create a ChangeLog to persist the email, for this we’ll go to the changelog file: <strong>src &gt; main &gt; resources &gt; config &gt; liquibase &gt; changelog</strong>. We need to create a file containing this format: year followed by month and followed by the actual day, together with the order of creation in that day (example: <strong>20221021000001_insert_EmailActionConfig_NameOfProcess_NomeOfSendTask.xml</strong>).</p>

<p><img src="./assets/images/email-connector/changelogPath.png" alt="Change log path" /></p>

<p><img src="./assets/images/email-connector/changeLogRedMarks.png" alt="Change log content" /></p>

<p>Following the red marks, we must create a changeSet to insert the email. Attention to the moment you identify the changeSet id, you need to write like the name of the changelog, but just with the numbers part, followed by a dash and the respective value of the changelog using ascending order. We need to pay attention to the tableName that should be <strong>akip_email_connector_config</strong>.</p>

<p>In the values of the columns we must put the name of the process (QuotationProcess) dot the name of the Send Task (EmailApprovalQuotation). After that we create a new changeSet with the sequence id of the previous one, but this time this changeSet will do a update, passing again the same tableName, but with the content of the column updated. The three files that we created before (content, mailbox and subject) in each name we must put with an underline and then “expression” like <strong>content_expression</strong>, followed by the valueClobFile that we pass the path to the respective file.</p>

<p>After completing the changeLog the last thing we need to do is to register this changelog in the master.xml.
<strong>src &gt; main &gt; resources &gt; config &gt; liquibase</strong></p>

<p><img src="./assets/images/email-connector/master.png" alt="Master.xml path" /></p>

<p>To register the changelog just put a line like this one in the file</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">include</span> <span class="n">file</span><span class="o">=</span><span class="s">"config/liquibase/changelog/20220930000001_insert_EmailActionConfig_QuotationProcess_EmailApprovalQuotation.xml"</span> <span class="n">relativeToChangelogFile</span><span class="o">=</span><span class="s">"false"</span><span class="o">/&gt;</span>
</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2022-08-07">August 07, 2022</time></p>
        
      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/kip4youoficial" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/kip4you" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Kip4You Team. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>










  </body>
</html>
